---
title: pnpm 为什么是神
category:
  - 笔记
tags:
  - Node
date: 2023-06-19 12:52:16
---

pnpm 为什么是神？在谈论这个问题之前，我想先说说其它包管理工具相较于 pnpm 究竟差在了哪里

<!-- more -->

## 前言

首先是犯下傲慢之罪的 npm

安装个依赖就要下载一堆无用的文件，这种傲慢的包管理工具注定走不长远，事实也是如此，靠着一个阴险的内置模块赢了神之后一直在走下坡路，最终泯然众人。与之相比神就很谦卑，node 6 的 `shrinkwrap`，node 7 的 `workspaces` 都是神留给凡人的慈悲，神不是不会，只是不想通过太完美的表现让对手绝望所以故意不用，可笑有些人不理解神的良苦用心，竟然还用这些事来讥讽神，我劝你们好自为之。

然后是犯下愤怒之罪的 yarn

因为自己家 facebook 说 npm 的不好就去自己开发，安装有人提到神的名字就怒气冲冲地打出自己的 logo，违背了神在《新约》中的一句话：“我觉得开发者就是要能很好的控制自己的情绪吧。” 于是神降下了它的惩罚，yarn 依赖冲突，`package.json` 抢走缓存目录扣押配置文件，更染上 pnp 一蹶不振。

接着是犯下懒惰之罪的 cnpm

自以为拿下了国内市场就了不起了，自创软链安装法。另外大家有所不知，其实在 node 14 发布前，cnpm 安装软链接依赖的时候，其磁盘中看见的目录，正是站在光芒之中的 pnpm，那时神告诉它：“你只可到这里，不可越过。然而，神的劝说不但没有让 cnpm 迷途知返，竟然还敢在发布会伙同 node 头号魔头（指 node_modules）正面挑战神的威严，于是神降下了它的惩罚，cnpm 在开发者中身败名裂，曾经的国内占有率没人记得，从此成为了众人口中的 bug 产生器。

再然后是犯下了嫉妒之罪 tyarn

屡次被神击败，但口服心不负的 tyarn，暗中嫉妒着神，甚至胆敢当众说出如果好好准备地话（指 lockfile），感觉自己会更强这种话。于是，在含金量最高的云监控平台，即 datadog，tyarn 被神正面击溃。不过，念在尺弟最终皈依了神的教，并且践行神的意志讨伐了屡次以下犯上的 cnpm 后，神应许了它在字节跳动的一切。

编不下去了（草）

~~犯下贪婪之罪的 rush~~
~~犯下暴食之罪的 lerna~~
~~最后，犯下淫欲之罪的 volar~~

## 前言 · 改

只要涉及项目开发，就一定离不开包管理工具，例如 C# 的 nuget，又或者 Rust 的 cargo、Python 的 pip 等等...不过对于前端而言，Javascript 的包管理工具，却有那么一点点（🤏）的不一样。

由于 Node 内置的 `npm` 在早期有着各种各样的问题，所以人们更倾向于使用 `yarn` 来替代。而近些年，`pnpm` 这个词逐渐被人们熟知，截至目前（2023/06/16），其在 Github 上更有着高达 24.2k 的 star。

但话又说回来，有人说它性能更好，也有人说它节省空间。仅凭这只言片语，你也许并不能体会到 pnpm 的魅力所在，比起 npm、yarn，pnpm 的优势究竟体现在哪里？

## yarn 的由来

npm（全称 Node Package Manager）是 Node.js **默认的**，以 Javascript 编写的包管理系统。仅需一个 `npm install` 命令，就会将社区中他人编写好的模块包下载到 `node_modules` 目录中，以便自己引入使用。

但在 `npm v3` 之前，node_modules 有一个很严重的问题，那便是 **依赖嵌套**。

例如现在有一个名为 A 的模块包，它又依赖了另一个名为 B 的依赖包，那么在此时，项目的文件目录将会是以下的结构：

```tex
.
├─ node_modules/
│  └─ A/
│     └─ node_modules/
│        └─ B/
└─ package.json
```

乍一看...好像也没什么问题？任何模块下，只要存在着第三方依赖，就都会有 node_modules 目录，依此类推并层层嵌套，那么情况稍微复杂一点会怎么样？

现在有 A、B、C 三个模块包，
